<!doctype html>
<html lang="en">
<!-- Fighting mongoose  file load  -->

	<head>
		<meta charset="UTF-8">
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
			  integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
		<link rel="stylesheet" type="text/css" href="../myStyles.css">
		<link rel="shortcut icon" type="image/ico" href="../Assets/Bits_and_Bytes_Logo.ico"/>
    <title>Form Upload</title>
		<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js' type='text/javascript'></script>
		<script type='text/javascript'>
			$.get('../Templates/Header.html',function(response){
				$('#header').html(response);
			});
			$.get('../Templates/Footer.html',function(response){
				$('#footer').html(response);
			});
		</script>
	</head>

	<script>
      function showImage() {
        var file    = document.querySelector('#impfile').files[0];
        var reader  = new FileReader();

        reader.addEventListener("load", function () {
          // prints base64 to screen
          // this reader.result value can be uploaded to db
          setModal('[Preview] ' + file.name, reader.result, file.type)
          console.log(reader.result)
        }, false);

        if (file) {
          reader.readAsDataURL(file);
        }
    }

    function setModal(title, url, filetype) {
      // remove old modal content and create new one
      // must do this for .pdf as the #document gets stale and immutable
      const obj = document.createElement('object')
      obj.id = 'modal-image'
      obj.style.minHeight = '40em'
      obj.style.height = '100%'
      obj.style.width = '100%'
      obj.data = url
      obj.type = filetype

      $('#modal-image').remove()
      document.querySelector('.modal-body').appendChild(obj)
      $('#fileModal').modal('show')

      $('.modal-title').text(title) 
    }


    async function viewUpload(file_uuid, filetype, isPublic) {
      let file_url
      // if (isPublic === '1')
        file_url = `https://storage.googleapis.com/fighting-mongooses-storage-dev/${file_uuid}`
      // else {
      //   const data = await fetch(`${ROOT_URI}/api/file/${file_uuid}`, { credentials: 'include' })
      //     .then(resp => { return resp.json() })
      //     .then(data => { return data })
      //     .catch(err => alert('error'))

      //   console.log(data.url)
      //   file_url = data.url
      // }

      console.log(file_uuid)
      console.log(filetype)
      console.log(isPublic)

      // update modal properties
      $('#modal-image').remove()
      setModal(file_uuid, file_url, filetype)
      $('#fileModal').modal('show')
    }



    var alert_close_timer
    function displayAlert(msg, classes) {
      // reset alert if currently being displayed
      window.clearTimeout(alert_close_timer)
      $('.alert').removeClass('alert-success alert-warning alert-danger')

      // set alert
      $('#alert_text').html(msg)
      $('.alert').addClass(classes).show()
      alert_close_timer = setTimeout(() => {$('.alert').hide().removeClass(classes)}, 2000);
    }
  </script>
  <script type="text/javascript" src="../js/root_uri.js"></script>
  <script type="text/javascript" src="../js/admin_required_file/getFiles.js"></script>
  <script type="text/javascript" src="../js/admin_required_file/deleteFile.js"></script>




	<body onLoad='getFiles()'>
    <div class="container-fluid">

       <div id="header"></div>


      <form method="POST" action="/api/required_file/upload" enctype="multipart/form-data">
          <h1>Upload required forms to Bits and Bytes</h1>
          <hr class="half_horizontal_rule">
          <h2>Choose a file to upload.</h2>


        <div class="input-group mb-3 col-6">
          <div class="input-group-prepend">
            <span class="input-group-text" id="inputGroup-sizing-default" for="title">Title</span>
          </div>
          <input id="title" name="title" type="text" class="form-control" aria-label="Default" aria-describedby="inputGroup-sizing-default">
        </div>

        <div class="input-group mb-3 col-6">
          <div class="input-group-prepend">
            <span class="input-group-text" id="inputGroup-sizing-default" for="description">Description</span>
          </div>
          <input id="description" name="description" type="text" class="form-control" aria-label="Default" aria-describedby="inputGroup-sizing-default">
        </div>

        <input type="file" name="file" size="75" id="impfile" onchange="showImage()" accept=".jpg, .pdf, .img, .png">

        <input class='btn btn-primary btn-lg' type="submit">  


<!--
          <button class='btn btn-info btn-md' type="button" name="file" size="75" id="impfile" onclick="showImage()">Preview</button>
-->

        </form>
      <br>
      <hr>

      <a class='btn btn-sm btn-outline-secondary' href='http://localhost:8080/api/required_file/me'>My Completed Files</a>
      <a class='btn btn-sm btn-outline-secondary' href='http://localhost:8080/api/required_file/me/todo'>My Incomplete Files</a>


      <table id='uploads-table'></table>


      <!-- Modal -->
      <div class="modal fade" id="fileModal" tabindex="-1" role="dialog" aria-labelledby="fileModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="fileModalLabel"></h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body modal-lg">
                <object id='modal-image' style='min-height: 40em' height='100%' width='100%' data='' type=''>
                  <!-- <embed  height="800em" width="100%" src="https://storage.googleapis.com/fighting-mongooses-storage-dev/oly_testwow_stage.jpg" type="image/jpeg" /> -->
                </object>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>


			<div id="footer"></div>
		</div>
    <!-- jQuery things -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
            integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
            crossorigin="anonymous">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
            integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
            crossorigin="anonymous">
    </script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
            integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
            crossorigin="anonymous">
    </script>
	</body>
</html>
