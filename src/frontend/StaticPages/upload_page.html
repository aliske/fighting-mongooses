<!DOCTYPE html>
<!-- Fighting mongoose  file load  -->
  <head lang="en">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <meta charset="UTF-8">
	<style>
		h1 {
		text-align:  center;
		color:white;
		}
		h2 {
		text-align:  left;
		color:white;
		}
		body {
		background-color:green;
		}
   </style>	

	<script>
      function showImage() {
        var preview = document.querySelector('#dispimage');
        var file    = document.querySelector('#impfile').files[0];
        var reader  = new FileReader();

        reader.addEventListener("load", function () {
          preview.data = reader.result;
          preview.style.height = '500px'
          preview.style.width = '100%'

          // prints base64 to screen
          // this reader.result value can be uploaded to db
          console.log(reader.result)
        }, false);

        if (file) {
          reader.readAsDataURL(file);
        }
    }


    async function viewUpload(file_uuid, filetype, isPublic) {
      let file_url
      if (isPublic === '1')
        file_url = `https://storage.googleapis.com/fighting-mongooses-storage-dev/${file_uuid}`
      else {
        const data = await fetch(`${ROOT_URI}/api/storage/${file_uuid}`)
          .then(resp => { return resp.json() })
          .then(data => { return data })
          .catch(err => alert('error'))

        console.log(data.url)
        file_url = data.url
      }

      console.log(file_uuid)
      console.log(filetype)
      console.log(isPublic)

      // update modal properties
      // $('#modal-image')[0].html()
      $('#modal-image')[0].data = file_url
      $('#modal-image')[0].type = filetype
      $('#fileModal').modal('show')
    }


    var alert_close_timer
    function displayAlert(msg, classes) {
      // reset alert if currently being displayed
      window.clearTimeout(alert_close_timer)
      $('.alert').removeClass('alert-success alert-warning alert-danger')

      // set alert
      $('#alert_text').html(msg)
      $('.alert').addClass(classes).show()
      alert_close_timer = setTimeout(() => {$('.alert').hide().removeClass(classes)}, 2000);
    }
  </script>
  <script type="text/javascript" src="../js/root_uri.js"></script>
  <script type="text/javascript" src="../js/uploads/get_uploads.js"></script>



	<head>
    <title>file upload</title>
  </head>


	<body onLoad='getUploads(false)'>
    <div class="alert alert-dismissible fade show" role="alert">
      <span id='alert_text'></span>
    </div>
    <ul class="nav">

			<li>
			<img src="../Assets/Bits_and_Bytes_Logo.png" alt="Bits and Bytes Logo" height = 100px>
			</li>

			<li class="nav-item">
			<a class="nav-link active" href="../index.html">Home</a>
			</li>

			<li class="nav-item">
			<a class="nav-link active" href="Announcements.html">Announcements</a>
			</li>

			<li class="nav-item">
			<a class="nav-link" href="upload_page.html">Uploads</a>
			</li>
    </ul>

    <form method="POST" action="/api/storage/upload" enctype="multipart/form-data">
        <h1>Upload forms to Bits and Bytes</h1>
        <hr class="half_horizontal_rule">
        <h2>Choose a file to upload.</h2>

        <input type="file" name="file" size="75" id="impfile" onchange="showImage()" accept=".jpg, .pdf, .img, .png">

        <input class='btn btn-primary btn-large' type="submit">

        <div class="form-check">
          <input class="form-check-input" type="radio" name="isPublic" id="publicRadios_true" value="true">
          <label class="form-check-label" for="publicRadios_true">
            public
          </label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="radio" name="isPublic" id="publicRadios_false" value="false" checked>
          <label class="form-check-label" for="publicRadios_false">
            private
          </label>
        </div>

        <button type="button" name="file" size="75" id="impfile" onclick="showImage()">Preview</button>


      </form>
    <br>

    <!-- Preview Content -->
    <object id="dispimage"></object>




    <hr>
    <button type=button onclick='getUploads(true)'>public uploads</button>
    <button type=button onclick='getUploads(false)'>My uploads</button>
    <table id='uploads-table'></table>





      <!-- Button trigger modal
    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#fileModal">
      Launch demo modal
    </button> -->

    <!-- Modal -->
    <div class="modal fade" id="fileModal" tabindex="-1" role="dialog" aria-labelledby="fileModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="fileModalLabel">Modal title</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body modal-lg">
              <object id='modal-image' style='min-height: 40em' height='100%' width='100%' data='' type=''>
                <!-- <embed  height="800em" width="100%" src="https://storage.googleapis.com/fighting-mongooses-storage-dev/oly_testwow_stage.jpg" type="image/jpeg" /> -->
              </object>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>



    <!-- jQuery things -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
            integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
            crossorigin="anonymous">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
            integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
            crossorigin="anonymous">
    </script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
            integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
            crossorigin="anonymous">
    </script>
	</body>
</html>
